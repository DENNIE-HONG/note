# 1. å‡½æ•°
## new æ“ä½œç¬¦å…·ä½“å¹²äº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ
1. åˆ›å»ºäº†ä¸€ä¸ªç©ºå¯¹è±¡ var obj = new Object();
2. è®¾ç½®åŸå‹é“¾ obj._proto = Func.prototype;
3. è®©Funcä¸­çš„thisæŒ‡å‘obj,å¹¶æ‰§è¡ŒFuncå‡½æ•°ä½“ï¼›
4. åˆ¤æ–­Funcè¿”å›å€¼ç±»å‹ï¼›
```js
function new (func) {
  let o = object.create(func.prototype);
  let k = func.call(o);
  return typeof k === 'object' ? k: o;
}
```

## bindçš„æ¨¡æ‹Ÿå®ç°ï¼Ÿ
bind()æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œå½“è¿™ä¸ªæ–°å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œbind()çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†ä½œä¸ºå®ƒè¿è¡Œæ—¶çš„thisã€‚ä¹‹åçš„å‚æ•°ä¼šåœ¨ä¼ é€’å®å‚å‰ä¼ å…¥ä½œä¸ºå®ƒçš„å‚æ•°ã€‚
```js
Function.prototype.bind = function(context) {
  var self = this;
  var args = Array.prototype.slice.call(arguments, 1);
  return function() {
    var bindArgs = Array.prototype.slice.call(arguments);
    self.apply(context, args.concat(bindArgs));
  }
}
```
é—®é¢˜ï¼š
ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨new æ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼Œè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŸå‡½æ•°å½“æˆæ„é€ å™¨ã€‚æä¾›çš„thiså€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™å‡½æ•°ã€‚
bindæ”¹è¿›ï¼š
```js
Function.prototype.bind = function(context) {
  if (typeof this !== 'function') {
    throw Error('è°ƒç”¨ä¸äº†');
  }
  var self = this;
  var args = Array.prototype.slice.call(arguments, 1);
  // ç©ºå‡½æ•°
  var FNop = function () {};
  var fbound = function () {
    // å½“ä½œæ„é€ å‡½æ•°ï¼ŒthisæŒ‡å‘å®ä¾‹ï¼ŒselfæŒ‡å‘
    // ç»‘å®šå‡½æ•°ï¼Œå½“æ™®é€šå‡½æ•°ï¼ŒthisæŒ‡å‘window
    self.apply(this instanceof self ? this: context, args.concat(Array.prototype.slice.call(arguments)));
  }
  FNop.prototype = this.prototype;
  // ä¿®æ”¹fbound.prototypeæ—¶å€™ï¼Œä¸æƒ³ä¿®æ”¹ç»‘å®šå‡½æ•°çš„prototype
  fbound.prototype = new FNop();
  return fbound;
}
```

## é—­åŒ…
æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­çš„å˜é‡çš„å‡½æ•°ã€‚

ä¾‹å¦‚ï¼š
```js
(function autorun() {
    let x = 1;
    $('#btn').on('click', function() {
        console.log(x);
    });
})();

// å½“å˜é‡xåœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è¢«ä½¿ç”¨ï¼Œå®ƒå°†ä¸€ç›´å­˜æ´»åˆ°æ”¹äº‹ä»¶å¤„ç†å‡½æ•°è¢«ç§»é™¤ã€‚
```
é—­åŒ…ä¸å¾ªç¯ï¼š
é—­åŒ…åªå­˜å‚¨å¤–éƒ¨å˜é‡çš„å¼•ç”¨ï¼Œè€Œä¸ä¼šæ‹·è´ã€‚
ä¾‹å¦‚ï¼š
```js
function initEvents() {
    for (var i = 1;i <= 3; i++) {
        $('#btn').on('click', function() {
            console.log(i);
        });
    }
}
// 3ä¸ªé—­åŒ…ï¼Œéƒ½å¼•ç”¨åŒä¸€ä¸ªå˜é‡iï¼Œiéšå¾ªç¯é€’å¢ï¼Œè¾“å‡ºåŒæ ·çš„å€¼
```




## å‡½æ•°å‚æ•°
å‚æ•°ä¼ é€’ï¼š
å‚æ•°æ˜¯åŸºæœ¬ç±»å‹æ˜¯æŒ‰å€¼ä¼ é€’ï¼Œå¼•ç”¨ç±»å‹æŒ‰**å…±äº«ä¼ é€’**

## é˜²æŠ–debounce
åŸç†ï¼š
ä¸€å®šåœ¨äº‹ä»¶è§¦å‘Nç§’åæ‰æ‰§è¡Œï¼Œå¦‚æœåœ¨ä¸€ä¸ªäº‹ä»¶è§¦å‘çš„nç§’å†…åˆè§¦å‘äº†ï¼Œä»¥æ–°çš„æ—¶é—´ä¸ºå‡†ã€‚ç­‰ä½ è§¦å‘å®Œäº‹ä»¶nç§’å†…ä¸å†è§¦å‘ï¼Œæ‰æ‰§è¡Œã€‚
ä¾‹å¦‚ï¼šresizeã€scrolläº‹ä»¶
```js
function debounce(fn, delay) {
  let timer = null;
  return function() {
    const context = this;
    const args = arguments;
    if (timer) {
      clearTimeout(timer);
    }
    timer = setTimeout(function() {
        func.apply(constext, args);
      }, delay);
    }
}
```


## èŠ‚æµthrottle
åŸç†ï¼šæŒç»­è§¦å‘äº‹ä»¶ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œåªæ‰§è¡Œä¸€æ¬¡äº‹ä»¶ã€‚
ä¾‹å¦‚ï¼šè¾“å…¥æ¡†çš„è”æƒ³
ç”¨setTimeoutå»¶è¿Ÿï¼Œè¿˜æ²¡å®Œæˆå°±å¿½ç•¥è¯·æ±‚ã€‚
```js
// å®šæ—¶å™¨å®ç°ï¼Œ
let throttle = function(func, delay) {
  let timer = null;
  return function() {
    const context = this;
    const args = arguments;
    if (!timer) {
      timer = setTimeout(function() {
        func.apply(context, args);
        timer = null;
      }, delay);
    }
  }
}
// æ—¶é—´æˆ³å®ç°ï¼Œäº‹ä»¶ä¼šç«‹å³æ‰§è¡Œï¼Œåœæ­¢è§¦å‘åä¸å†æ‰§è¡Œ
let throttle = function(fn, delay) {
 let prev = 0;
 return function() {
   const context = this;
   const args = arguments;
   const now = Date.now();
   if (now - prev >= delay) {
     func.apply(context, args);
     prev = now;
   }
 }
};

```

## åå‡½æ•°
å›ºå®šä¸€ä¸ªå‡½æ•°çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œå°†ä¸€ä¸ªnå…ƒå‡½æ•° => n-xå…ƒå‡½æ•°
```js
// å ä½ç¬¦
var _ = {};
function partial(fn) {
  var args = [].slice.call(arguments, 1);
  return function() {
    var position = 0;
    var len = args.length;
    for (var i = 0; i < len; i++) {
      args[i] = args[i] === _? arguments[position++]: args[i];

    }
    while (position < arguments.length) {
      args.push(arguments[position++]);
    }
    return fn.apply(this, args);
  }
}

var subtract = function(a, b) {
  return b-a;
}
subForm20 = partial(subract, _, 20);
subForm(5); // 15
```
## å‡½æ•°ç»„åˆ
åŸç†ï¼šå°†å¤šä¸ªå‡½æ•°ç»„åˆä¸€èµ·ï¼Œä»å³å‘å·¦æ‰§è¡Œã€‚
ä½œç”¨ï¼šåˆ©ç”¨æŸ¯é‡ŒåŒ–å’Œcomposeå®ç°pointfreeã€‚
ä¸ä½¿ç”¨æ‰€è¦å¤„ç†çš„å€¼ï¼Œåªåˆæˆè¿ç®—ã€‚ä¸Šå±‚è¿ç®—ä¸ç›´æ¥æ“ä½œæ•°æ®ï¼Œé€šè¿‡åº•å±‚å»å¤„ç†ã€‚

```js
function compose() {
  let args = arguments;
  const start = args.length - 1;
  return function() {
    let i = start;
    let result = args[start].apply(this, arguments);
    while(i--) {
      result = args[i].call(this, result);
    }
    return result;
  }
}
```

## å°¾è°ƒç”¨ä¼˜åŒ–TCO
å‡å°‘è°ƒç”¨æ ˆå¸§ï¼Œå¼•æ“ä¸ç”¨é™åˆ¶æ ˆæ·±åº¦ã€‚
ä¾‹å­ï¼šé€’å½’
```js
function factoria(n) {
  function fact(n, res) {
    if (n < 2) {
      return res;
    }
    return fact(n-1, n * res);
  }
  return fact(n, 1);
}
```



# 2. å¯¹è±¡
å³ä½¿åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹å‚æ•°çš„å€¼ï¼ŒåŸå§‹å¼•ç”¨ä¿æŒæœªå˜.å±€éƒ¨å¯¹è±¡ç«‹å³è¢«é”€æ¯ã€‚
```js
function setName(obj) {
  obj.name = "Nicholas";
  obj = new Object();
  obj.name = "Greg";
}
var person = new Object();
setName(person);
alert(person.name); // Nicholas
```
<font color="red">å¯¹è±¡çš„å¥è‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œ</font>ä¾‹å¦‚ï¼š

```js
const a = {};
const b = {key: "b"};
const c = {key: "c"};
a[b] = 123;
a[c] = 456;
console.log(a[b]); // 456
// a["Object object"] = 123;
// a["Object object"] = 456;
```






## Blobå¯¹è±¡
è¡¨ç¤ºä¸€ä¸ªåªè¯»åŸå§‹æ•°æ®çš„ç±»æ–‡ä»¶å¯¹è±¡ï¼ŒäºŒè¿›åˆ¶åŸå§‹æ•°æ®æ ¼å¼ã€‚
Fileå¯¹è±¡ç»§æ‰¿è‡ªBlobå¯¹è±¡ï¼Œæä¾›äº†nameã€sizeã€typeç­‰åŸºç¡€å…ƒæ•°æ®ã€‚  

ğŸŒ°ï¼šåˆ›å»ºä¸€ä¸ªä»¥äºŒè¿›åˆ¶æ•°æ®å­˜å‚¨çš„htmlæ–‡ä»¶
```js
const text = "<div>hello world</div>";
const blob = new Blob([text], {
  type: "text/html"
});
// ä»¥æ–‡æœ¬è¯»å–
const textReader = new FileReader();
textReader.readAsText(blob);
textReader.onload = function() {
  console.log(textReader.result);
}
```
URL.createObjectURL(object);  
ğŸŒ°ï¼šä»¥BlobURLåŠ è½½ç½‘ç»œè§†é¢‘ï¼Ÿ
```js
function ajax(url, cb) {
  const xhr = new XMLHttpRequest();
  xhr.open("get", url);
  xhr.responseType = "blob";
  xhr.onload = function() {
    cb(xhr.response);
  }
  xhr.send();
}

ajax('video.mp4', function(res) {
  const src = URL.createObjectURL(res);
  video.src = src;
});
```

### åˆ›å»ºå¯¹è±¡çš„å¤šç§æ–¹å¼ä¸ä¼˜ç¼ºç‚¹ï¼Ÿ
#### 1. å·¥å‚æ¨¡å¼
```js
function createPerson(name) {
  var obj = new Object();
  obj.name = name;
  obj.getName = function() {
    console.log(this.name);
  }
  return obj;
}
```
ç¼ºç‚¹ï¼šå¯¹è±¡æ— æ³•è¯†åˆ«ï¼Œæ‰€æœ‰å®ä¾‹æŒ‡å‘ä¸€ä¸ªåŸå‹ã€‚

#### 2. æ„é€ å‡½æ•°æ¨¡å¼
```js
function Person(name) {
  this.name = name;
  this.getName = function() {
    console.log(this.name);
  }
}
```
ä¼˜ç‚¹ï¼šå®ä¾‹å¯è¯†åˆ«ä¸ºä¸€ä¸ªç‰¹å®šç±»å‹ã€‚
ç¼ºç‚¹ï¼šæ¯æ¬¡åˆ›å»ºæ—¶ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½è¦è¢«åˆ›å»ºä¸€æ¬¡ã€‚

#### 3. åŸå‹æ¨¡å¼
```js
function Person(name) {}
Person.prototype = {
  constructor: Person,
  name: 'kevin',
  getName: function() {
    console.log(this.name);
  }
};
```
ä¼˜ç‚¹ï¼šæ¯æ¬¡åˆ›å»ºå¯¹è±¡ï¼Œæ–¹æ³•ä¸ä¼šé‡å¤åˆ›å»ºã€‚
ç¼ºç‚¹ï¼šæ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½å…±äº«ï¼Œä¸èƒ½åˆå§‹åŒ–å‚æ•°ã€‚

#### 4. ç»„åˆæ¨¡å¼
```js
function Person(name) {
  this.name = name;
}
Person.prototype = {
  constructor: Person,
  getName: function() {
    console.log(this.name);
  }
}
```
ä¼˜ç‚¹ï¼šè¯¥ç§æœ‰çš„ç§æœ‰ï¼Œè¯¥å…±äº«çš„å…±äº«ï¼Œæœ€å¹¿æ³›çš„æ–¹å¼ã€‚

#### 5. å¯„ç”Ÿæ„é€ å‡½æ•°æ¨¡å¼
```js
function Person(name) {
  var obj = new Object();
  obj.name = name;
  obj.getName = function() {
    console.log(this.name);
  }
}
var person = new Person('kevin');

```
ç‰¹æ®Šæƒ…å†µä¸‹ä½¿ç”¨ï¼Œå¦‚åˆ›å»ºé¢å¤–æ–¹æ³•çš„ç‰¹æ®Šæ•°ç»„ï¼Œåˆä¸æƒ³ç›´æ¥ä¿®æ”¹Arrayæ„é€ å‡½æ•°ã€‚æ¯”å·¥å‚æ¨¡å¼å¤šä¸ªnewã€‚


### å¦‚ä½•åˆ¤æ–­2ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Ÿ
æ³¨æ„ï¼š
1. +0ä¸-0ä¸åŒï¼›
```js
if(a === b) return a !== 0 || 1/a === 1/b;
```
2. NaNä¸NaNç›¸åŒï¼›
```js
if (a!== a) return b !== b;
```
3. åˆ©ç”¨Object.prototype.toString.call(obj)ï¼›
```js
...
case '[object RegExp]':
case '[object String]':
  // éšå¼ç±»å‹è½¬æ¢
  return '' + a === '' + b;
case '[object Date]':
case '[object Boolean]':
  return +a === +b;
```
4. æ•°ç»„ => é€’å½’ï¼Œå¯¹è±¡ => é€’å½’ï¼›
5. æ’é™¤å‡½æ•°ï¼›
6. æ’é™¤nullï¼Œå°½æ—©é€€å‡ºï¼›
7. æ³¨æ„å¾ªç¯å¼•ç”¨ï¼Œé¿å…æ­»å¾ªç¯ï¼Œå¤šä¼ é€’2ä¸ªå‚æ•°astackå’Œbstack,ç”¨æ¥å­˜å‚¨aå’Œbé€’å½’æ¯”è¾ƒä¸­çš„aå’Œbçš„å€¼ï¼›




### JSON.stringify

#### ç‰¹æ€§
ä¸¾ä¸ªğŸŒ°ï¼š
```js
const data = {
    a: "aaa",
    b: undefined,
    c: Symbol("dd"),
    fn: function() {
        return true;
    }
};
JSON.stringify(data);
// "{"a": "aaa"}"
```
1. undefinedã€å‡½æ•°ã€symbol => å±æ€§ => è·³è¿‡ï¼›


```js

JSON.stringify(function a() {}); // undefined
JSON.stringify(undefined);// undefined
JSON.stringify(Symbol("dd"));// undefined

```

2. NaNå’ŒInfinityæ ¼å¼æ•°å€¼ => null
```js

JSON.stringify(NaN); // "null"
JSON.stringify(null);// "null"
JSON.stringify(Infinity);// "null"

```
3. å¸ƒå°”ã€æ•°å­—ã€å­—ç¬¦ä¸²çš„åŒ…è£…å¯¹è±¡ => åŸå§‹å€¼
```js

JSON.stringify(new Boolean(false)); // false
JSON.stringify(new Number(1));// 1
JSON.stringify(new String("false"));// "false"

```

#### replacer


JSON.stringify(value[, replacer[, space]])  
replacer: å‡½æ•°oræ•°ç»„ï¼Œæ¯ä¸ªå±æ€§éƒ½ç»è¿‡è¿™ä¸ªå‡½æ•°å¤„ç†ï¼Œè¿”å›å€¼å³åºåˆ—åŒ–åçš„å€¼ã€‚  
ä¾‹å­ï¼šä½¿ç”¨å‡½æ•°è¿‡æ»¤å¹¶åºåˆ—åŒ–å¯¹è±¡ã€‚

```js
function replacer(key, value) {
    if (typeof value === 'string') {
        return undefined;
    }
    return value;
}
var foo = {
    fundation: "Mozilla",
    model: "box",
    week: 45,
    month: 7
};
var jsonString = JSON.stringify(foo, replacer);
// {"week": 45, "month": 7}

```
#### å¯¹è±¡çš„toJSON:
å¯¹è±¡çš„toJSON, è¢«åºåˆ—åŒ–æ—¶ï¼Œä¸ä¼šå¯¹å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼Œè€Œæ˜¯å°†å®ƒçš„toJSONæ–¹æ³•çš„è¿”å›å€¼è¿›è¡Œåºåˆ—åŒ–ã€‚
ä¾‹å­ï¼š
```js
var obj = {
    foo: 'foo',
    toJSON: function() {
        return 'bar';
    }
};
JSON.stringify(obj); // "bar"
JSON.stringify({x: obj}); // '{"x": "bar"}'
```










# 3. åŸå‹
jsä¸­æ ¹å¯¹è±¡æ˜¯Object.prototype,æ¯ä¸ªå¯¹è±¡éƒ½æ˜¯ä»Object.prototypeå…‹éš†æ¥çš„ã€‚

**åŸå‹é“¾**
é€šè¿‡_proto_æŒ‡é’ˆæŒ‡å‘ä¸Šä¸€ä¸ªåŸå‹ï¼Œå¹¶ä»é‡ç»§æ‰¿æ–¹æ³•å’Œå±æ€§ï¼ŒåŒæ—¶åŸå‹å¯¹è±¡ä¹Ÿå¯èƒ½æ‹¥æœ‰åŸå‹ï¼Œä¸€å±‚ä¸€å±‚ï¼Œæœ€ç»ˆæŒ‡å‘nullã€‚

```js
var obj = new Object(); // åŸå‹ => Object.prototype

```


## ç»§æ‰¿
ä»¥ä¸‹3ç§ç»§æ‰¿æ–¹æ³•ä¸ä¼˜ç¼ºç‚¹ï¼Ÿ
```js
function Shape() {}
function Rect() {}
```
### æ–¹æ³•1
```js
Rect.prototype = new Shape();
```
ä¼˜ç‚¹ï¼š
* æ­£ç¡®è®¾ç½®åŸå‹é“¾å®ç°ç»§æ‰¿ï¼›
* çˆ¶ç±»å®ä¾‹å±æ€§å¾—åˆ°ç»§æ‰¿ï¼ŒåŸå‹é“¾æŸ¥æ‰¾æ•ˆç‡é«˜ï¼›

ç¼ºç‚¹ï¼š
* çˆ¶ç±»å®ä¾‹å±æ€§ä¸º**å¼•ç”¨ç±»å‹**æ—¶å€™ï¼Œä¸æ°å½“ä¿®æ”¹ä¼šå¯¼è‡´æ‰€æœ‰å­ç±»ä¿®æ”¹ï¼›
* æ— æ³•ç¡®å®šæ„é€ å‡½æ•°éœ€è¦çš„åˆç†å‚æ•°ï¼›

### æ–¹æ³•2
```js
Rect.prototype = Shape.prototype;
```
ç¼ºç‚¹ï¼šä¿®æ”¹å­ç±»åŸå‹ï¼Œæ·»åŠ æ–¹æ³•ä¼šä¿®æ”¹çˆ¶ç±»
### æ–¹æ³•3
```js
Rect.prototype = Object.create(Shape.prototype);
Rect.prototype.area = function() {
  // do something
}
```
é¿å…äº†1.2ä¸­çš„ç¼ºç‚¹

### ä¸ºä»€ä¹ˆç”¨Object.create(null)æ¥åˆ›å»ºå¯¹è±¡ï¼Ÿè€Œä¸ç”¨{}
å› ä¸º{}ä¼šç»§æ‰¿ObjectåŸå‹é“¾ä¸Šæ‰€æœ‰æ–¹æ³•ã€‚è€ŒåŸå‹æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œä¾‹å¦‚åˆ«çš„åº“orå¼€å‘è€…ä¿®æ”¹äº†ObjectåŸå‹ï¼Œ{}ä¹Ÿä¼šç»§æ‰¿ä¿®æ”¹åçš„æ–¹æ³•ã€‚









## é—®é¢˜
Q. symbolæ˜¯æ„é€ å‡½æ•°ï¼Ÿ  
A: å¹¶ä¸å®Œæ•´ï¼Œä¸æ”¯æŒnew Symbolï¼Œä½†åŸå‹ä¸Šæ‹¥æœ‰construtorå±æ€§ã€‚  
construtorå€¼åªè¯»å—ï¼Ÿ
å¼•ç”¨ç±»å‹construtorå¯ä¿®æ”¹ï¼Œä½†åŸºæœ¬ç±»å‹åªè¯»ã€‚

Q:_proto_ä¸prototype:  
A: _proto_æ˜¯æ¯ä¸ªå®ä¾‹ä¸Šéƒ½æœ‰çš„å±æ€§ï¼Œprototypeæ˜¯æ„é€ å‡½æ•°çš„å±æ€§ï¼Œå¹¶ä¸ä¸€æ ·ã€‚_proto_åœ¨es6æ—¶è¢«æ ‡å‡†åŒ–ã€‚

Q: æ™®é€šå‡½æ•°åˆ›å»ºçš„å®ä¾‹æœ‰æ²¡æœ‰constructorå±æ€§ï¼Ÿ  
A: ä¸ä¸€å®šã€‚
```js
function parent(age) {
    return {
        age: age
    };
}
var p  = parent(50);
p.construtor === Object; // true
```

```js
  _________                     _________________
 | æ„é€ å‡½æ•° |â€”â€”â€”â€”â€”â€”prototypeâ€”â€”â€”â€”>|åŸå‹             |
 | Parent  |<â€”â€”â€”â€”construtorâ€”â€”â€”â€”â€”|Parent.prototype|
  â€”â€”â€”â€”â€”â€”â€”â€”â€”                      â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    |                                ^
    |                                |
   new                               |
    |                                |
  __â†“____                            |
 |å®ä¾‹å¯¹è±¡|â€”â€”â€”â€”â€”â€”_proto__â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”|
 | p    |
  â€”â€”â€”â€”â€”â€”â€”

 _______             _________________             ________________             _____
|å®ä¾‹å¯¹è±¡|            |       åŸå‹     |            |      åŸå‹      |            |    |
|   p  |â€”_proto_â€”â€”â€”>|Parent.prototype| â€”_proto_â€”â€”>| Object.protypt| â€”_proto_â€”â€”>|null|
 â€”â€”â€”â€”â€”â€”              â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”              â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”              â€”â€”â€”â€”â€”
```






# 4. this
### ç”¨ECMAScriptè§„èŒƒè§£è¯»this  ï¼ˆè¾ƒéš¾ï¼‰
å‰æï¼šä»€ä¹ˆæ˜¯Reference?
* ç”¨æ¥è§£é‡Šè¯¸å¦‚delete/typeof ä»¥åŠèµ‹å€¼ç­‰æ“ä½œè¡Œä¸ºçš„ã€‚Reference Typeæœ¬èº«æ˜¯ä¸€ä¸ªä¸‰ä¸ªå€¼çš„ç»„åˆ(base,name,strict)

MemberExpression?
ä¸€èˆ¬æ˜¯()çš„å·¦è¾¹

1. è®¡ç®—MemberExpressionèµ‹ç»™ref
2. åˆ¤æ–­refæ˜¯ä¸æ˜¯Reference?
    * æ˜¯ï¼Œthis = GetBase(ref);
    * æ˜¯ï¼Œbase valueæ˜¯Environment Record, this => undefiend
    * ä¸æ˜¯ï¼Œthis => undefined

æ —å­
```js
var value = 1;
var foo = {
  value: 2,
  bar: function() {
    return this.value;
  }
}
```
1. console.log(foo.bar()):
```js
ref = MemberExpression() = foo.bar
// æ˜¯Reference
Reference = {
  base: foo,
  name: 'bar',
  strict: false
}
// this = GetBase(ref)
// this = foo
// ç­”æ¡ˆæ˜¯2
```

2. console.log((foo.bar)())
()å¹¶æ²¡æœ‰å¯¹MemberExpressionè®¡ç®—ï¼Œç»“æœä¸ä¸Šé¢ä¸€æ ·

3. console.log((foo.bar = foo.bar)());
èµ‹å€¼æ“ä½œç¬¦=ï¼Œè¿”å›ä¸æ˜¯Reference.
this = undefined, ç­”æ¡ˆæ˜¯1
4. console.log((false || foo.bar)());
é€»è¾‘ä¸è¿ç®—ï¼Œä¸æ˜¯Referenceç±»å‹ï¼Œthis = undefined
5. console.log((foo.bar, foo.bar)());
é€—å·è¿ç®—ç¬¦ï¼Œè¿”å›ä¸æ˜¯Referenceç±»å‹ï¼Œthis = undefined

### thisç»‘å®š
æ˜¾æ€§ã€éšå½¢ã€ç¡¬ç»‘å®šã€newç»‘å®šã€é»˜è®¤ç»‘å®š
ç»‘å®šä¼˜å…ˆçº§ï¼šnewç»‘å®š > ç¡¬ç»‘å®šoræ˜¾ç¤º > éšå¼ > é»˜è®¤
æ›´å®‰å…¨çš„thisï¼š è°ƒç”¨æ—¶æ ¹æœ¬ä¸åœ¨ä¹thisæŒ‡å‘è°æ—¶ï¼Œå¯ç”¨
```js
const a = Objact.create(null);
foo.apply(a, [2, 3]);
```

## 5. æ“ä½œç¬¦
### 5.1 ~X

#### indexofä¼˜é›…å†™æ³•
~X ç­‰åŒäº -(x+1)
```js
~42; // -43
```
-1 æ˜¯ä¸€ä¸ª"å“¨ä½å€¼"ï¼ŒindexOf(...)æ‰¾ä¸åˆ°å­—ç¬¦ä¸²æ‰€åœ¨ä½ç½®ï¼Œè¿”å›-1.
ä¾‹å¦‚ï¼š
```js
const a = "Hello World";
if (a.indexOf("ol") === -1) {
  // æ²¡æœ‰åŒ¹é…åˆ°ï¼ŒæŠ½è±¡æ¸—æ¼ï¼Œæš´éœ²äº†åº•å±‚å®ç°ç»†èŠ‚
}

if (!~a.indexOf("ol")) {
  console.log("æ²¡æœ‰åŒ¹é…åˆ°");
}
```


#### æˆªå–æ•°å­—çš„å°æ•°éƒ¨åˆ†æ›´é è°±

```js
const d = 3.14;
const e = -3.14;
console.log(Math.floor(d), ~~d); // 3 3
console.log(Math.floor(e), ~~e); // -4 -3
```



### 5.2 éšå¼è½¬æ¢
#### 5.2.1 éšå¼è½¬æ¢ä¸ºå¸ƒå°”
* if ()
* for(..;...;...)
* while(...)å’Œdo...while(...)
* ?:
* ||å’Œ&&

#### 5.2.2 x == y
==ï¼šå…è®¸å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä¼šå‡ºå¾ˆå¤šæ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚
##### æƒ…å†µ1ï¼š
1. xå¸ƒå°”ï¼Œè¿”å›ToNumber(x) == y
2. yå¸ƒå°”ï¼Œè¿”å›x == ToNumber(y)
å“ªä¸ªæ˜¯å¸ƒå°”ï¼Œå…ˆè½¬ä¸ºæ•°å­—ã€‚
```js
const x = "42";
const y = true;
console.log(x == y); // false
```
**å°½é‡ä¸è¦ä½¿ç”¨ == trueå’Œ == falseæƒ…å†µ**
ä¸¾ä¸ªğŸŒ°ï¼š
```js
const a = "42";
if (a == true) {} // false
if (a === true){} // false
if (a) {} // true
if (!aa) {} // æ›´å¥½ï¼ï¼ï¼
if(Boolean(a)) {} // true

```

```js
false == 0; => 0 == 0; // true
false === ""; => 0 == "" ; => 0 == 0; // true
false == []; => false == ""; => 0 == ""; => 0 == 0; // true
```
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

##### æƒ…å†µ2ï¼š
1. x nullï¼Œy = undefiend, true
2. x = undefiend, y = null, true
```js
let a = null;
let b;
console.log(a == b); // true
console.log(a == null); // true
console.log(b == null); // true

let a = doSomething(); // è¿”å›null or undefiend
if (a == null) {} // true
```
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
##### æƒ…å†µ3ï¼š
x == y ? (å¯¹è±¡ vs æ•°å­—orå­—ç¬¦ä¸²)ï¼šå“ªä¸ªæ˜¯å¯¹è±¡ï¼Œå¯¹è±¡å…ˆè½¬æˆ**å­—ç¬¦ä¸²**ï¼Œå†å¯¹æ¯”
```js
const a = "abc";
const b = Object(a);
console.log(a == b); // true
```

```js
const a = null;
const b = Object(a);
console.log(a == b); // false
```
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
##### æƒ…å†µ4ï¼š
1. xæ•°å­—ï¼Œyå­—ç¬¦ä¸²ï¼Œx == ToNumber(y);
2. xå­—ç¬¦ä¸²ï¼Œyæ•°å­—ï¼ŒToNumber(x) == y;
å“ªä¸ªæ˜¯å­—ç¬¦ä¸²ï¼Œè½¬ä¸ºæ•°å­—å†å¯¹æ¯”ï¼›

```js
"0" == false; è½¬ "0" == 0; è½¬ 0 == 0; // true,å¸ƒå°”å…ˆè½¬æ•°å­—
"" == []; è½¬ "" == ""; // true, å¯¹è±¡å…ˆè½¬å­—ç¬¦ä¸²
0 == []; è½¬ 0 == ""; è½¬ 0 == 0; // true
```
æ³¨æ„ï¼š**==â€œâ€ã€==0**
ä¸¾ä¸ªä¾‹å­ï¼š
```js
function doSomething(a) {
  if (a == "") {...} // æ”¹ç”¨a === ""
}
doSomething(0);
doSomething([]); // éƒ½ä¼šæ‰§è¡Œ
```

#### 5.2.3 a < b å…³ç³»æ¯”è¾ƒ
å…³ç³»æ¯”è¾ƒæ—¶å€™ï¼Œå…ˆè¿›è¡Œæ˜¾å¼å¼ºåˆ¶ç±»å‹è½¬æ¢
ä¸¾ä¸ªä¾‹å­ï¼š
```js
const a = { b: 42};
const b = {b: 43};
console.log(a < b); //false
console.log(a == b); // false
console.log(a > b); // false
console.log(a <= b); // true
console.log(a >= b); // true
a <= b;   è½¬æˆ  !(b < a); å¾—åˆ° true
```

#### 5.2.4 x + y
å‘æ¥äº†ï¼š
```js
[] + {}; // ["object Object"]
{} + []; // 0
```
+å­—ç¬¦ä¸²å˜æ•°å­—
```js
[] + {}; è½¬ "" + "[object Object]"; => ["object Object"];
{} + []; è½¬ +[] ; => + "" => 0; // ç©ºä»£ç å—ï¼Œä¸ä½œä»»ä½•æ“ä½œ
```


#### 5.2.5 parseInt
parseInt(string)ï¼Œä¼ å…¥æ˜¯éå­—ç¬¦ä¸²ä¼šè¢«éšå¼è½¬ä¸ºå­—ç¬¦ä¸²å†è§£æã€‚

```js
const a = [1, 2, 3];
console.log(parseInt(a)); // '1,2,3' => 1
console.log(parseInt(true)); // 'true' => NAN

parseInt(0.000008); // '0.000008' => 0
parseInt(0.0000008); // '8e-7' => 8
parseInt(1/0, 19); // parseInt(æ— ç©·å¤§ï¼Œ19)ï¼›=> 18
```




## 5.3 ?:å’Œ =
éƒ½æ˜¯å³å…³è”çš„ã€‚
```js
a ? b : c ? d: e;    =>    a ? b : (c ? d: e);
```
```js
a = b = c = 42;  =>   a = (b = (c = 42));
```


# 6.ç±»å‹

## typeofçš„å®ç°åŸç†
jsåœ¨åº•å±‚å­˜å‚¨å˜é‡ï¼Œå†æœºå™¨ç ä½ä½ä¸Š1-3ä½å­˜ç±»å‹ä¿¡æ¯ï¼š
* 000ï¼šå¯¹è±¡
* 010ï¼šæµ®ç‚¹
* 100ï¼šå­—ç¬¦ä¸²
* 110ï¼šå¸ƒå°”
* 1ï¼š æ•´æ•°

nullï¼šæ‰€æœ‰æœºå™¨ç å‡ä¸º0.
undefiend: ç”¨-2^30æ•´æ•°è¡¨ç¤ºã€‚
æ‰€ä»¥ typeof nullç›´æ¥åˆ¤æ–­æˆå¯¹è±¡

## instanceofçš„åŸç†ï¼š

```js
function new_instanceof (leftValue, rightValue) {
    let rightProps = rightValue.prototype;
    leftValue = leftValue._proto_;
    while(true) {
        if (leftValue === null) {
            return false;
        }
        if (leftValue === rightProps) {
            return true;
        }
        leftValue = leftValue._prototype_;
    }
}
// å³è¾¹å˜é‡çš„prototypeåœ¨å·¦è¾¹å˜é‡çš„åŸå‹é“¾ä¸Š
```
ä¾‹å¦‚ï¼šObject instanceof object;
å³è¾¹çš„åŸå‹ï¼š Object.prototype;
å·¦è¾¹çš„Object._proto_ = Function.prototype;
Function.prototype._proto_ = Object.prototype;


## ç±»å‹åˆ¤æ–­
```js
let class2type = {};
// ç”Ÿæˆclass2typeæ˜ å°„
"Boolean Number String Function Array Date RegExp Object Error".split(" ").map(function(item, index) {
  class2type["[object] " + item + "]"] = item.toLowerCase();
});

function type(obj) {
  if(obj == null) {
    return obj + '';
  }
  return typeof obj === 'object' || typeof obj === "function" ? calss2type[Object.prototype.toStrig.call(obj)] || "object" : typeof obj;
}
```


## æ•°æ®ç»“æ„
### 1 æ ˆæ•°æ®ç»“æ„
**åå…¥å…ˆå‡ºLIFO**, ä»»ä½•ä¸åœ¨æ ˆé¡¶çš„å…ƒç´ éƒ½æ— æ³•è®¿é—®ã€‚

```js
  å…ˆè¿›åå‡º
  åè¿›å…ˆå‡º
                   å‡ºæ ˆ
                    â†‘
  __________________|_
 |  ________________  |
 | |____true________|â†|â€”â€”â€”â€”â€”â€”â€”â€”æ ˆé¡¶
 | |____..._________| |
 | |____4___________| |
 | |____3___________|â†|â€”â€”â€”â€”â€”â€”â€”â€”æ ˆåº•
 |                    |
 |____________________|
```
* å ç”¨ç©ºé—´å°
* å¤§å°å›ºå®š
* æŒ‰å€¼è®¿é—®
```js
         ___________________
        |      æ ˆå†…å­˜        |    String
        |   _____________   |    Number
        |  |_____________|  |    Boolean
        |  |_____________|  |    Null
        |  |_____________|  |    Undefined
        |  |_num2_|_2____|  |    Symbol
        |  |_num1_|_1____|  |
        |___________________|
```

### 2. å †æ•°æ®ç»“æ„
å †æ˜¯ä¸€ç§ç»è¿‡æ’åºçš„æ ‘å½¢æ•°æ®ç»“æ„ï¼Œæ ¹èŠ‚ç‚¹å€¼æœ€å°(æœ€å¤§)ï¼Œå­˜å–éšæ„ï¼Œæ¯”å¦‚å›¾ä¹¦é¦†å–ä¹¦ï¼Œä¹¦æ‘†æ”¾æœ‰é¡ºåºï¼Œå–ä¹¦åªçœ‹ä¹¦åã€‚

**æ³¨æ„ï¼š**
é—­åŒ…ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ä¸ä¿å­˜åœ¨æ ˆå†…å­˜ä¸­ï¼Œå­˜åœ¨å †å†…å­˜ä¸­ã€‚

```js

  _________________________              _______________________
  |   å˜é‡å¯¹è±¡              |             |      å †å†…å­˜ç©ºé—´        |
  |   __________________  |              |   ______________     |
  |  |å˜é‡å|_å…·ä½“å€¼______| |       |â€”â€”â€”â€”â€”â€”â€”â€”>|   [1,2,3]    |    |     å æ®ç©ºé—´å¤§
  |  |_a1__|_0__________| |       |      |   â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”     |     å¤§å°ä¸å›ºå®š
  |  |_a2__|_'hello'____| |  å¼•ç”¨  |      |    _________         |
  |  |_a3__|_null_______| |       |      |    |_object_|        |
  |  |_c___|_0x0012ffk__|â€”|â€”â€”â€”â€”â€”â€”â€”       |    __________        |
  |  |_b___|_0x0012ff2d_|â€”|â€”â€”â€”å¼•ç”¨â€”â€”â€”â€”â€”â€”â€”â€”|â€”â€”>|_{m:20}__|        |
  |_______________________|              |______________________|
```

å¼•ç”¨æ•°æ®ç±»å‹å­˜å‚¨åœ¨å †å†…å®¹ä¸­ï¼Œåœ¨æ ˆä¸­å­˜äº†æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘å¯¹ä¸­è¯¥å®ä½“çš„èµ·å§‹åœ°å€ã€‚
å…ˆæ‰¾æ ˆä¸­åœ°å€ ---> å †ä¸­å–å¾—å®ä½“
